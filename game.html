<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Different Game</title>
  <style>
    canvas {
      border: 1px black solid;
    }
  </style>
  <script src="utils.js"></script>
  <script src="game.js"></script>
  <script src="paddle.js"></script>
  <script src="ball.js"></script>
  <script src="block.js"></script>
</head>
<body>
  <canvas id="id-canvas" width="400" height="300"></canvas>
  <script>
    var __main = function() {
      var game = Game(30)

      var paddle = Paddle()    
      var ball = Ball()

      var blocks = []
      for (var i = 0; i < 3; i++) {
        var b = Block()
        // 设置 block 坐标
        b.x = i * 150
        b.y = 50
        blocks.push(b)
      }

      var paused = false
      game.registerAction('a', function(){
        paddle.moveLeft()
      })
      game.registerAction('d', function(){
        paddle.moveRight()
      })
      game.registerAction('f', function(){
        ball.fire()
      })
      window.addEventListener('keydown', function(event){
        if (event.key == 'p') {
          paused = !paused
        }
      })

      game.update = function() {
        if (paused) {
          return
        }
        ball.move()
        // 判断相撞
        if (paddle.collide(ball)) {
          // 这里应该调用一个 ball.反弹() 来实现
          ball.反弹()
        }
        // 判断 ball 和 blocks 相撞
        for (var i = 0; i < blocks.length; i++) {
          var block = blocks[i]
          if (block.collide(ball)) {
            log('block 相撞')
            block.kill()
            ball.反弹()
          }
        }
      }
      game.draw = function() {
        // draw
        game.drawImage(paddle)
        game.drawImage(ball)
        // draw block
        for (var i = 0; i < blocks.length; i++) {
          var block = blocks[i]
          if (block.alive) {
            game.drawImage(block)
          }
        }
      }
    }

    __main()

  </script>
</body>
</html>